<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>KnowledgeGroove — AI Tool</title>
  <link rel="stylesheet" href="ai.css">
</head>
<body>
  <main class="container">
    <h1>Simple Python AI Tools (in-browser)</h1>
    <p class="lead">This page runs a small Python tool using Pyodide. No server required.</p>

    <label for="input">Enter text:</label>
    <textarea id="input" rows="10" placeholder="Paste or type text here..."></textarea>

    <div class="controls">
      <label for="sentences">Summary sentences:</label>
      <input id="sentences" type="number" min="1" max="10" value="3" />

      <button id="summarizeBtn">Summarize (Python)</button>
      <button id="keywordsBtn">Extract Keywords (Python)</button>
    </div>

    <section>
      <h2>Output</h2>
      <pre id="output" class="output">No output yet.</pre>
    </section>

    <footer>
      <p>Powered by Pyodide — Python runs in your browser.</p>
    </footer>
  </main>

  <!-- Load Pyodide from CDN -->
  <script src="https://cdn.jsdelivr.net/pyodide/v0.23.4/full/pyodide.js"></script>

  <script>
    // Initialize UI elements
    const inputEl = document.getElementById('input');
    const outputEl = document.getElementById('output');
    const summarizeBtn = document.getElementById('summarizeBtn');
    const keywordsBtn = document.getElementById('keywordsBtn');
    const sentencesEl = document.getElementById('sentences');

    let pyodide = null;
    let pyLoaded = false;

    async function loadPyodideAndModule() {
      outputEl.textContent = "Loading Python runtime (Pyodide)...";
      pyodide = await loadPyodide();
      outputEl.textContent = "Pyodide loaded. Loading Python tool...";
      // Fetch the Python tool and run it so its functions are available in globals
      const resp = await fetch('ai_tool.py');
      const pyCode = await resp.text();
      await pyodide.runPythonAsync(pyCode);
      outputEl.textContent = "Tool loaded. Paste text above and choose an action.";
      pyLoaded = true;
    }

    function ensureLoaded() {
      if (!pyLoaded) {
        outputEl.textContent = "Still loading Pyodide — please wait a moment.";
        return false;
      }
      return true;
    }

    summarizeBtn.addEventListener('click', async () => {
      if (!ensureLoaded()) return;
      const text = inputEl.value.trim();
      if (!text) { outputEl.textContent = "Please enter some text."; return; }
      outputEl.textContent = "Running summarizer...";
      try {
        // Put text into Python global
        pyodide.globals.set("input_text", text);
        const n = Math.max(1, parseInt(sentencesEl.value) || 3);
        // Call the Python function; it returns a string
        const pyResult = await pyodide.runPythonAsync(`summarize(input_text, ${n})`);
        // pyResult is a PyProxy; convert to string
        outputEl.textContent = pyResult.toString();
        pyResult.destroy && pyResult.destroy();
        pyodide.globals.delete("input_text");
      } catch (err) {
        outputEl.textContent = "Error running summarizer: " + err;
        console.error(err);
      }
    });

    keywordsBtn.addEventListener('click', async () => {
      if (!ensureLoaded()) return;
      const text = inputEl.value.trim();
      if (!text) { outputEl.textContent = "Please enter some text."; return; }
      outputEl.textContent = "Extracting keywords...";
      try {
        pyodide.globals.set("input_text", text);
        const pyResult = await pyodide.runPythonAsync(`extract_keywords(input_text, 12)`);
        // Convert Python list to JS array
        const jsList = pyResult.toJs ? pyResult.toJs() : Array.from(pyResult);
        outputEl.textContent = jsList.join(', ');
        pyResult.destroy && pyResult.destroy();
        pyodide.globals.delete("input_text");
      } catch (err) {
        outputEl.textContent = "Error extracting keywords: " + err;
        console.error(err);
      }
    });

    // Start loading immediately
    loadPyodideAndModule().catch(err => {
      outputEl.textContent = "Failed to load Pyodide: " + err;
      console.error(err);
    });
  </script>
</body>
</html>